---
# MAXIMALIST DASHBOARD
# Energy View
# Made by Madelena Mak 2022

title: Energy
path: "energy"
theme: "Fluent Red"

type: "custom:grid-layout"
layout: !include snippets/layout-page-margin.yaml

cards:
  - type: "custom:layout-card"
    layout_type: "custom:grid-layout"
    view_layout:
      grid-area: cc
    layout:
      grid-template-columns: "repeat(auto-fill, [col-start] minmax(400px, 1fr) [col-end])"
      grid-template-rows: auto
      grid-column-gap: 32px
      margin: -1px
      mediaquery:
        "(max-width: 800px)":
          grid-template-columns: "repeat(auto-fill, [col-start] minmax(240px, 1fr) [col-end])"

    cards:
      # [Header] Summary
      - type: "custom:layout-card"
        layout_type: "custom:grid-layout"
        layout: !include snippets/layout-page-title.yaml
        view_layout:
          grid-column: 1/-1
        cards:
          - type: markdown
            style: !include snippets/style-markdown-page-title.yaml
            content: >
              # Energy
          - type: "custom:layout-card"
            layout_type: "custom:grid-layout"
            layout:
              margin: 0
              padding: 0
              card_margin: 1px
            view_layout:
              place-self: end right
            cards:
              - entity: sensor.time
                template: clock
                type: custom:button-card
                variables:
                  entity_date: sensor.date
                  entity_temperature: sensor.tempest_st_00056115_temperature
                  entity_weather: weather.east_tamworth_hourly

      # [Row] Summary + Totals
      - type: "custom:layout-card"
        layout_type: "custom:grid-layout"
        layout:
          margin: 0
          grid-template-columns: "repeat(auto-fill, [col-start] minmax(360px, 1fr) [col-end])"
        view_layout:
          grid-column-start: 1
          grid-column-end: -1
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: LIVE DATA
            view_layout:
              grid-column: 1/-1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 24
                  - hours_to_show: 1
                  - entities:
                      - entity: sensor.sungrowsolar_load_power
                  - decimals: 3
                  - title: House Load
                  - icon: "mdi:home-lightning-bolt"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 24
                  - hours_to_show: 1
                  - entities:
                      - entity: sensor.sungrowsolar_solar_production
                  - decimals: 3
                  - title: Solar Production
                  - icon: "mdi:solar-panel"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 24
                  - hours_to_show: 1
                  - entities:
                      - entity: sensor.sungrowsolar_import_from_grid
                  - decimals: 3
                  - title: Import from Grid
                  - icon: "mdi:transmission-tower-export"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 24
                  - hours_to_show: 1
                  - entities:
                      - entity: sensor.sungrowsolar_export_to_grid
                  - decimals: 3
                  - title: Export to Grid
                  - icon: "mdi:transmission-tower-import"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

      - type: "custom:layout-card"
        layout_type: "custom:grid-layout"
        layout:
          margin: 0
          grid-template-columns: "repeat(auto-fill, [col-start] minmax(360px, 1fr) [col-end])"
        view_layout:
          grid-column-start: 1
          grid-column-end: -1
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: HOURLY DATA
            view_layout:
              grid-column: 1/-1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 12
                  - hours_to_show: 24
                  - entities:
                      - entity: sensor.sungrowsolar_daily_direct_energy_consumption
                  - decimals: 1
                  - title: Direct Solar Consumption
                  - icon: "mdi:home-lightning-bolt"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 12
                  - hours_to_show: 24
                  - entities:
                      - entity: sensor.sungrowsolar_daily_power_yields
                  - decimals: 1
                  - title: Solar Production
                  - icon: "mdi:solar-panel"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 12
                  - hours_to_show: 24
                  - entities:
                      - entity: sensor.sungrowsolar_daily_import_energy
                  - decimals: 1
                  - title: Import from Grid
                  - icon: "mdi:transmission-tower-export"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

          - type: vertical-stack
            in_card: true
            cards:
              - type: "custom:decluttering-card"
                template: mini_graph_tile

                variables:
                  - points_per_hour: 12
                  - hours_to_show: 24
                  - entities:
                      - entity: sensor.sungrowsolar_daily_export_energy
                  - decimals: 1
                  - title: Export to Grid
                  - icon: "mdi:transmission-tower-import"
                  - line_width: 2
                  - aspect_ratio: 2.5/1

      - type: "custom:layout-card"
        layout_type: "custom:grid-layout"
        layout:
          margin: 0
          grid-template-columns: 100%
        view_layout:
          grid-column-start: 1
          grid-column-end: -1
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: DAILY DATA
            view_layout:
              grid-column: 1/-1
          - !include energy/graph_production.yaml

      - type: "custom:layout-card"
        layout_type: "custom:grid-layout"
        layout:
          margin: 0
          grid-template-columns: 100%
        view_layout:
          grid-column-start: 1
          grid-column-end: -1
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: YEARLY DATA
            view_layout:
              grid-column: 1/-1
          - !include energy/graph_yield_year.yaml

      # [Column] Workspace
      - type: "custom:layout-card"
        layout_type: "custom:grid-layout"
        layout:
          margin: -1
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: WORKSPACE

          - type: "custom:auto-entities"
            filter:
              template: |
                {% for sensor in expand('group.energy_workspace') -%}
                  {%- set name = state_attr(sensor.entity_id,"friendly_name") | regex_replace(find='smartenergy_metering', replace='') | regex_replace(find=' Plug', replace='') | regex_replace(find='Energy Use', replace='') -%}
                  {{
                    { 'entity': sensor.entity_id,
                      'type': 'custom:decluttering-card',
                      'template': 'multi_graph_card',
                      'name': name,
                      'variables': [
                        {'hours_to_show': 48},
                        {'entities': [sensor.entity_id]},
                        {'title': name},
                        {'lower_bound': 0},
                        {'upper_bound': '~200'},
                        {'height': 128}
                      ],
                    }
                  }},
                {%- endfor %}
            sort:
              method: state
              reverse: true
              numeric: true
            card:
              type: "custom:layout-card"
              layout_type: "custom:grid-layout"
              layout_options:
                margin: -1
