---
type: vertical-stack
cards:
  - type: custom:state-switch
    entity: mediaquery
    states:
      "(min-width: 801px)":
        type: "custom:button-card"
        template: header_card_no_link
        variables:
          name: TBSH3
        view_layout:
          grid-column: 1/-1

  - type: entities
    card_mod:
      style:
        fold-entity-row$: |
          ha-icon {
            background: none !important;
            margin-right: 24px !important;
            --toggle-icon-width: 21px !important;
            color: rgb(var(--rgb-disabled-color));
          }
        .: |
          .card-content {
            padding: 0;
          }
    entities:
      - type: custom:fold-entity-row
        head:
          type: custom:mushroom-template-card
          icon: mdi:docker
          primary: TBSH3 Docker - Updates
          secondary: >
            Count: {{states|selectattr('entity_id', 'search', 'update.wud_container_tbsh3_') | selectattr('state', 'eq', 'on') | list | count }}
          card_mod:
            style: |
              ha-card {
                background: none;
                --ha-card-box-shadow: 0px;
              }
          icon_color: orange
          tap_action:
            action: toggle
        padding: 0
        entities:
          - type: custom:auto-entities
            filter:
              include:
                - entity_id: update.wud_container_tbsh3_*
                  state: "on"
                  options:
                    type: custom:mushroom-update-card
                    show_buttons_control: true
                    layout: horizontal
                    entities:
                      - this.entity_id
                    card_mod:
                      style: |
                        ha-card {
                          background: none;
                          padding: 4px 16px !important;
                          --ha-card-box-shadow: 0px;
                        }
            card:
              type: custom:layout-card
              cards: []
              layout_type: masonry
            sort:
              method: friendly_name
        card_mod:
          style: |
            :host {
              --ha-card-border-width: 0;
              --ha-card-background: none;
              --ha-card-box-shadow: 0;
            }

  - square: false
    columns: 3
    type: grid
    cards:
      - type: custom:config-template-card
        entities:
          - sensor.tbsh3_monitordocker_containers_total
        card:
          type: custom:stack-in-card
          cards:
            - type: custom:apexcharts-card
              chart_type: radialBar
              series:
                - entity: sensor.tbsh3_monitordocker_containers_running
                  color: green
                  max: >-
                    ${Number(states['sensor.tbsh3_monitordocker_containers_total'].state)}
                  show:
                    legend_value: false
              apex_config:
                plotOptions:
                  radialBar:
                    offsetY: 0
                    startAngle: -108
                    endAngle: 108
                    hollow:
                      size: 65%
                    dataLabels:
                      name:
                        show: false
                      value:
                        show: false
                    track:
                      strokeWidth: 80%
                      margin: 0
                legend:
                  show: false
                chart:
                  height: 170px
            - type: custom:mushroom-entity-card
              entity: sensor.tbsh3_monitordocker_containers_running
              primary_info: name
              secondary_info: state
              name: Running
              icon_color: green
              layout: vertical
              card_mod:
                style: |
                  ha-card {
                    top: -63px;
                  }
          card_mod:
            style: |
              ha-card {
                height: 158px;
              }
      - type: custom:config-template-card
        entities:
          - sensor.tbsh3_monitordocker_containers_total
        card:
          type: custom:stack-in-card
          cards:
            - type: custom:apexcharts-card
              chart_type: radialBar
              series:
                - entity: sensor.tbsh3_monitordocker_containers_paused
                  color: orange
                  max: >-
                    ${Number(states['sensor.tbsh3_monitordocker_containers_total'].state)}
                  show:
                    legend_value: false
              apex_config:
                plotOptions:
                  radialBar:
                    offsetY: 0
                    startAngle: -108
                    endAngle: 108
                    hollow:
                      size: 65%
                    dataLabels:
                      name:
                        show: false
                      value:
                        show: false
                    track:
                      strokeWidth: 80%
                      margin: 0
                legend:
                  show: false
                chart:
                  height: 170px
            - type: custom:mushroom-entity-card
              entity: sensor.tbsh3_monitordocker_containers_paused
              primary_info: name
              secondary_info: state
              name: Paused
              icon_color: orange
              layout: vertical
              card_mod:
                style: |
                  ha-card {
                    top: -63px;
                  }
          card_mod:
            style: |
              ha-card {
                height: 158px;
              }
      - type: custom:config-template-card
        entities:
          - sensor.tbsh3_monitordocker_containers_total
        card:
          type: custom:stack-in-card
          cards:
            - type: custom:apexcharts-card
              chart_type: radialBar
              series:
                - entity: sensor.tbsh3_monitordocker_containers_stopped
                  color: red
                  max: >-
                    ${Number(states['sensor.tbsh3_monitordocker_containers_total'].state)}
                  show:
                    legend_value: false
              apex_config:
                plotOptions:
                  radialBar:
                    offsetY: 0
                    startAngle: -108
                    endAngle: 108
                    hollow:
                      size: 65%
                    dataLabels:
                      name:
                        show: false
                      value:
                        show: false
                    track:
                      strokeWidth: 80%
                      margin: 0
                legend:
                  show: false
                chart:
                  height: 170px
            - type: custom:mushroom-entity-card
              entity: sensor.tbsh3_monitordocker_containers_stopped
              primary_info: name
              secondary_info: state
              name: Stopped
              icon_color: red
              layout: vertical
              card_mod:
                style: |
                  ha-card {
                    top: -63px;
                  }
          card_mod:
            style: |
              ha-card {
                height: 158px;
              }

  - type: custom:auto-entities
    unique: true
    show_empty: true
    card:
      type: entities
      show_header_toggle: false
      card_mod:
        style: |
          ha-card {
            border: 0;
            box-shadow: none;
          }
          .card-content {
            padding-left: 0;
          }
    filter:
      template: >
        {% for s in
        states|selectattr('entity_id','search','sensor.tbsh3_monitordocker_')
            |rejectattr('entity_id','search','_1cpu')
            |rejectattr('entity_id','search','_containers_')
            |rejectattr('entity_id','search','_cpu')
            |rejectattr('entity_id','search','_images')
            |rejectattr('entity_id','search','_memory')
            |rejectattr('entity_id','search','_version')
            |sort(attribute="attributes.friendly_name")  -%}
        {{ { "type": "custom:fold-entity-row", "head": {
            "type": "custom:mushroom-template-card",
            "entity": s.entity_id,
            "icon": "mdi:docker",
            "primary": "{{ state_attr(entity, 'friendly_name') }}\n",
            "secondary": "{{ state_attr(entity, 'status') }}\n",
            "icon_color": "green",
            "card_mod": {
                "style": "ha-card {\n  border: 0;\n  box-shadow: none;\n}\n"
            }
        }, "padding": 0, "entities": [
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "image",
                "icon": "mdi:information-outline",
                "name": "Image"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "uptime",
                "icon": "mdi:clock",
                "name": "Container Start Time"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "health",
                "icon": "mdi:heart-pulse",
                "name": "Health"
            },
            {
                "type": "section"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "cpu_percentage",
                "suffix": "%",
                "icon": "mdi:chip",
                "name": "CPU (Percent)"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "1cpu_percentage",
                "suffix": "%",
                "icon": "mdi:chip",
                "name": "1CPU (Percent)"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "memory",
                "suffix": "Mb",
                "icon": "mdi:memory",
                "name": "Memory"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "memory_percentage",
                "suffix": "%",
                "icon": "mdi:memory",
                "name": "Memory (Percent)"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "network_speed_up",
                "suffix": "kB/s",
                "icon": "mdi:upload",
                "name": "Network Speed - Up"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "network_speed_down",
                "suffix": "kB/s",
                "icon": "mdi:download",
                "name": "Network Speed - Down"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "network_total_up",
                "suffix": "MB",
                "icon": "mdi:upload",
                "name": "Network Total - Up"
            },
            {
                "type": "attribute",
                "entity": s.entity_id,
                "attribute": "network_total_down",
                "suffix": "MB",
                "icon": "mdi:download",
                "name": "Network Total - Down"
            }
        ], "card_mod": {
            "class": "content",
            "style": "ha-card {\n  border: 0;\n}\n#measure {\n  padding-left: 20px !important;\n  padding-right: 20px !important;\n  }\n#states {\n  padding-top: 0px !important;\n  padding-bottom: 0px !important;\n}\n"
        } }}},  {%- endfor %}
    options: null
    sort:
      method: friendly_name
    card_mod:
      style:
        fold-entity-row$: |
          ha-icon {
            background: none !important;
            margin-right: 24px !important;
            --toggle-icon-width: 21px !important;
            color: rgb(var(--rgb-disabled-color));
          }
          ha-icon:active {
            animation: rotate 200ms linear forwards;
          }
          @keyframes rotate {
            100% { transform: rotate(180deg); }
          }
        .: |
          ha-card {
            background: none;
            box-shadow: none;
          }
          .card-content {
            padding: 0;
          }
          * {
            margin: 0 !important;
          }
