---
title: Home Assistant
path: homeassistant
icon: mdi:home-assistant
theme: "Fluent Red"

type: "custom:grid-layout"
layout: !include snippets/layout-page-margin.yaml

cards:
  - type: "custom:layout-card"
    layout_type: "custom:grid-layout"
    layout:
      grid-template-columns: "repeat(auto-fill, [col-start] minmax(450px, 1fr) [col-end])"
      grid-template-rows: auto
      grid-column-gap: 32px
      margin: -1px
      mediaquery:
        "(max-width: 800px)":
          grid-template-columns: "repeat(auto-fill, [col-start] minmax(256px, 1fr) [col-end])"
          margin: 0
    view_layout:
      grid-area: cc

    cards:
      # [Header] Summary
      - type: markdown
        style: !include snippets/style-markdown-page-title.yaml
        view_layout:
          grid-column: 1/-1
        content: >
          # Home Assistant

      # [Column] Watchman
      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: |
                <ha-icon style='--mdc-icon-size: var(--h4-font-size)' icon='mdi:shield-half-full'></ha-icon> WATCHMAN
            view_layout:
              grid-column: 1/-1

          - type: markdown
            card_mod: !include snippets/style-markdown-table.yaml
            content: >-
              <h2> <ha-icon icon='mdi:shield-half-full'></ha-icon> Watchman Entities Report<h2>
              <h3>Missing Entities: {{ states.sensor.watchman_missing_entities.state }} </h3>
              <table width="100%">
              <tr>
              <th></th>
              <th>Entity</th>
              <th>Where?</th>
              </tr>
              {% for item in state_attr("sensor.watchman_missing_entities", "entities") -%}
              <tr>
              <td><ha-icon icon='mdi:
              {%- if item.state=="missing"-%}cloud-alert'
              {%- elif item.state=="unavail" -%}cloud-off-outline' {%- else-%}cloud-question'
              {%- endif -%} ></ha-icon></td>
              <td>{{ item.id }}</td>
              <td>{{item.occurrences}}<td>
              </tr>
              {% endfor -%}
              </table>

          - type: markdown
            content: >-
              <h2> <ha-icon icon='mdi:shield-half-full'></ha-icon> Watchman Services Report<h2>
              <h3>Missing Services: {{ states.sensor.watchman_missing_services.state }} </h3>
              <table width="100%">
              <tr>
              <th></th>
              <th>Entity</th>
              <th>Where?</th>
              </tr>
              {% for item in state_attr("sensor.watchman_missing_services", "entities") -%}
              <tr>
              <td><ha-icon icon='mdi:cloud-alert'></ha-icon></td>
              <td>{{ item.id }}</td>
              <td>{{item.occurrences}}<td>
              </tr>
              {% endfor -%}
            card_mod:
              style:
                ha-markdown:
                  $: |
                    ha-markdown-element:first-of-type hr{
                      border-color: #303030;
                    }

          - type: entities
            title: "Unavailable Entities"
            show_header_toggle: false
            entities:
              - type: custom:auto-entities
                show_empty: true
                unique: true
                filter:
                  template: "{{ state_attr('sensor.unavailable_entities','entity_id') }}"
                sort:
                  method: state
                card:
                  type: custom:fold-entity-row
                  padding: 0
                  head:
                    entity: sensor.unavailable_entities

                  # [Column] Batteries

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: BATTERIES
            view_layout:
              grid-column: 1/-1

          - card:
              style: |
                ha-card {
                  background-color: var(--dwains-theme-primary);
                  box-shadow: none;
                }
                .card-header {
                  padding: 5px 16px 10px;
                  font-size: 18px;
                  font-weight: 700 !important;
                }
              type: entities
            filter:
              include:
                - entity_id: sensor.*battery*
                  options:
                    entity_row: true
                    height: 4
                    max: 100
                    min: 0
                    positions:
                      icon: "off"
                      indicator: "off"
                      name: inside
                      value: inside
                    style: |-
                      bar-card-row {
                        height: 12px;
                        padding-top: 36px;
                      }
                      bar-card-background {
                        background: var(--primary-background-color);
                      }
                      bar-card-contentbar {
                        margin-top: -16px;
                      }
                      bar-card-name, bar-card-value {
                        margin: 0;
                      }
                    type: custom:bar-card
                  state: <=100
                  unit_of_measurement: "%"
                - attributes:
                    device_class: battery
                  domain: sensor
                  options:
                    entity_row: true
                    height: 4
                    max: 100
                    min: 0
                    positions:
                      icon: "off"
                      indicator: "off"
                      name: inside
                      value: inside
                    style: |-
                      bar-card-row {
                        height: 12px;
                        padding-top: 36px;
                      }
                      bar-card-background {
                        background: var(--primary-background-color);
                      }
                      bar-card-contentbar {
                        margin-top: -16px;
                      }
                      bar-card-name, bar-card-value {
                        margin: 0;
                      }
                    type: custom:bar-card
                  state: <=100
            sort:
              method: state
              numeric: true
              reverse: true
            type: custom:auto-entities

      # [Column] Batteries

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: HOME ASSISTANT SERVER
            view_layout:
              grid-column: 1/-1

          - type: vertical-stack
            cards:
              # - type: custom:mushroom-chips-card
              #   chips:
              #     # - type: entity
              #     #   entity: sensor.processor_temperature
              #     #   icon_color: orange
              #     # - type: entity
              #     #   entity: sensor.processor_use
              #     #   icon_color: blue
              #     - type: entity
              #       entity: sensor.memory_use_percent
              #       icon_color: orange
              #     - type: entity
              #       entity: sensor.disk_use_percent_config
              #       icon_color: deep-purple
              #     # - type: entity
              #     #   entity: sensor.network_in_eth0
              #     #   icon_color: green
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-update-card
                    entity: update.home_assistant_core_update
                    name: HA Core
                    show_buttons_control: true
                    icon_type: entity-picture
                  - type: custom:mushroom-template-card
                    primary: Version Information
                    secondary: >-
                      Installed v{{ state_attr('update.home_assistant_core_update',
                      'installed_version')}}

                      Latest v{{ state_attr('update.home_assistant_core_update',
                      'latest_version')}}
                    icon: mdi:package-variant-closed
                    multiline_secondary: true
                    fill_container: true
                    entity: update.home_assistant_core_update
                    tap_action:
                      action: more-info
                    icon_color: |-
                      {% if is_state('update.home_assistant_core_update', 'on') %}
                        orange
                      {% else %}
                        green
                      {% endif %}
                    badge_color: |-
                      {% if is_state('update.home_assistant_core_update', 'on') %}
                        red
                      {% else %}
                        blue
                      {% endif %}
                    badge_icon: |-
                      {% if is_state('update.home_assistant_core_update', 'on') %}
                        mdi:help
                      {% else %}
                        mdi:check-bold
                      {% endif %}
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-update-card
                    entity: update.home_assistant_operating_system_update
                    name: HA OS
                    show_buttons_control: true
                    icon_type: entity-picture
                  - type: custom:mushroom-template-card
                    primary: Version Information
                    secondary: >-
                      Installed v{{
                      states('sensor.home_assistant_operating_system_version')}}

                      Latest v{{
                      states('sensor.home_assistant_operating_system_newest_version')}}
                    icon: mdi:package-variant-closed
                    multiline_secondary: true
                    fill_container: true
                    entity: update.home_assistant_operating_system_update
                    tap_action:
                      action: more-info
                    icon_color: >-
                      {% if is_state('update.home_assistant_operating_system_update', 'on')
                      %}
                        orange
                      {% else %}
                        green
                      {% endif %}
                    badge_color: >-
                      {% if is_state('update.home_assistant_operating_system_update', 'on')
                      %}
                        red
                      {% else %}
                        blue
                      {% endif %}
                    badge_icon: >-
                      {% if is_state('update.home_assistant_operating_system_update', 'on')
                      %}
                        mdi:help
                      {% else %}
                        mdi:check-bold
                      {% endif %}
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-update-card
                    entity: update.home_assistant_supervisor_update
                    name: HA Supervisor
                    show_buttons_control: true
                    icon_type: entity-picture
                  - type: custom:mushroom-template-card
                    primary: Version Information
                    secondary: >-
                      Installed v{{ state_attr('update.home_assistant_supervisor_update',
                      'installed_version')}}

                      Latest v{{ state_attr('update.home_assistant_supervisor_update',
                      'latest_version')}}
                    icon: mdi:package-variant-closed
                    multiline_secondary: true
                    fill_container: true
                    entity: update.home_assistant_core_update
                    tap_action:
                      action: more-info
                    icon_color: |-
                      {% if is_state('update.home_assistant_supervisor_update', 'on') %}
                        orange
                      {% else %}
                        green
                      {% endif %}
                    badge_color: |-
                      {% if is_state('update.home_assistant_supervisor_update', 'on') %}
                        red
                      {% else %}
                        blue
                      {% endif %}
                    badge_icon: |-
                      {% if is_state('update.home_assistant_supervisor_update', 'on') %}
                        mdi:help
                      {% else %}
                        mdi:check-bold
                      {% endif %}

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: HACS UPDATES
            view_layout:
              grid-column: 1/-1

          - type: vertical-stack
            cards:
              - type: custom:mushroom-chips-card
                chips:
                  - type: template
                    icon: mdi:web
                    icon_color: blue
                    content: Changelog
                    tap_action:
                      action: url
                      url_path: https://github.com/hacs/integration/releases
                  - type: template
                    entity: update.hacs_update
                    content: Installed v{{ state_attr('update.hacs_update', 'installed_version') }}
                    icon_color: green
                    icon: mdi:package-variant-closed
                    tap_action:
                      action: none
                  - type: template
                    entity: update.hacs_update
                    content: Latest v{{ state_attr('update.hacs_update', 'latest_version') }}
                    icon_color: orange
                    icon: mdi:package-variant-closed
                    tap_action:
                      action: none
              - type: custom:stack-in-card
                cards:
                  - type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      grid-template-columns: auto 42px
                      margin: "-4px -4px -8px -4px;"
                    cards:
                      - type: custom:mushroom-template-card
                        icon: mdi:update
                        primary: HACS - Updates
                        secondary: >
                          Count: {{expand(integration_entities('hacs')) | selectattr('domain', 'eq', 'update') | selectattr('state', 'eq', 'on') | list | count }}
                        card_mod:
                          style: |
                            ha-card {
                              background: none;
                              --ha-card-box-shadow: 0px;
                            }
                      - type: custom:mushroom-template-card
                        entity: input_boolean.helper_frontend_hacs_updates
                        primary: ""
                        secondary: ""
                        icon: >-
                          {{ 'mdi:chevron-up' if is_state(entity, 'on') else 'mdi:chevron-down'
                          }}
                        icon_color: disabled
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            ha-card {
                              align-items: flex-end;
                              background: none;
                              --ha-card-box-shadow: 0px;
                            }
                            mushroom-shape-icon {
                              --shape-color: none !important;
                            }
                  - type: conditional
                    conditions:
                      - entity: input_boolean.helper_frontend_hacs_updates
                        state: "on"
                    card:
                      type: custom:auto-entities
                      filter:
                        include:
                          - domain: update
                            integration: hacs
                            state: "on"
                            options:
                              type: custom:mushroom-update-card
                              show_buttons_control: true
                              layout: horizontal
                              entities:
                                - this.entity_id
                              card_mod:
                                style: |
                                  ha-card {
                                    background: none;
                                    padding: 4px 16px !important;
                                    --ha-card-box-shadow: 0px;
                                  }
                      card:
                        type: custom:layout-card
                        cards: []
                        layout_type: masonry
                      sort:
                        ignore_case: true
                        method: name
              - type: custom:stack-in-card
                cards:
                  - type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      grid-template-columns: auto 42px
                      margin: "-4px -4px -8px -4px;"
                    cards:
                      - type: custom:mushroom-template-card
                        icon: mdi:update
                        primary: HACS - No Updates
                        secondary: >
                          Count: {{expand(integration_entities('hacs')) | selectattr('domain', 'eq', 'update') | selectattr('state', 'eq', 'off') | list | count }}
                        card_mod:
                          style: |
                            ha-card {
                              background: none;
                              --ha-card-box-shadow: 0px;
                            }
                      - type: custom:mushroom-template-card
                        entity: input_boolean.helper_frontend_hacs_noupdates
                        primary: ""
                        secondary: ""
                        icon: >-
                          {{ 'mdi:chevron-up' if is_state(entity, 'on') else 'mdi:chevron-down'
                          }}
                        icon_color: disabled
                        hold_action:
                          action: none
                        card_mod:
                          style: |
                            ha-card {
                              align-items: flex-end;
                              background: none;
                              --ha-card-box-shadow: 0px;
                            }
                            mushroom-shape-icon {
                              --shape-color: none !important;
                            }
                  - type: conditional
                    conditions:
                      - entity: input_boolean.helper_frontend_hacs_noupdates
                        state: "on"
                    card:
                      type: custom:auto-entities
                      filter:
                        include:
                          - domain: update
                            integration: hacs
                            state: "off"
                            options:
                              type: custom:mushroom-update-card
                              show_buttons_control: true
                              layout: horizontal
                              entities:
                                - this.entity_id
                              card_mod:
                                style: |
                                  ha-card {
                                    background: none;
                                    padding: 4px 16px !important;
                                    --ha-card-box-shadow: 0px;
                                  }
                      card:
                        type: custom:layout-card
                        cards: []
                        layout_type: masonry
                      sort:
                        ignore_case: true
                        method: name

      # [Column] Watchman
      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: WATCHMAN
            view_layout:
              grid-column: 1/-1

          - type: custom:atomic-calendar-revive
            maxDaysToShow: 90
            enableModeChange: true
            showWeekDay: true
            firstDayOfWeek: 1
            refreshInterval: 600
            showMonth: true
            showCurrentEventLine: false
            showDate: false
            sortByStartTime: true
            showDeclined: true
            showRelativeTime: false
            showMultiDay: false
            showMultiDayEventParts: true
            hideDuplicates: true
            showLastCalendarWeek: false
            calShowDescription: false
            disableCalLink: false
            disableCalLocationLink: false
            disableCalEventLink: false
            dimFinishedEvents: true
            showProgressBar: false
            showDescription: false
            entities:
              - entity: calendar.home_assistant_devs

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: header_card_no_link
            variables:
              name: HOME ASSISTANT SERVER
            view_layout:
              grid-column: 1/-1

          - type: vertical-stack
            cards:
              - type: entities
                card_mod:
                  style: |
                    ha-card {
                      border-style: none;
                      background: none;
                      --mush-title-padding: 0px 0px 0px;
                    }
                    div.card-content {
                      padding-bottom: 0px
                    }
                entities:
                  - type: custom:mushroom-title-card
                    title: Add-ons
                    subtitle: >-
                      {{ integration_entities('Supervisor') | map('device_id') | unique |
                      list | length }} Add-ons installed
              - type: custom:auto-entities
                card:
                  type: entities
                  card_mod:
                    style: |
                      ha-card {
                        border-style: none;
                        background: none;
                        --mush-title-font-size: 20px;
                        --mush-title-padding: 0px 5px 0px;
                      }
                      h1.card-header{
                        padding: 6px 16px 0px;
                      }
                      div.card-content {
                        padding-top: 0px
                      }
                filter:
                  template: >
                    {%- set dev = namespace() %} {%- set dev.name = '' %} {%- set
                    dev.running = '' %} {%- set dev.newest_version = '' %} {%- set
                    dev.version = '' %} {%- set dev.cpu_percent = '' %} {%- set
                    dev.memory_percent = '' %} {%- set dev.update = '' %}

                    {%- for devid in (integration_entities('Supervisor') | map('device_id')
                    | unique) %}
                      {%- set dev.name = device_attr(devid, "name") %}
                      {%- for ent in device_entities(devid) %}
                        {%- if (ent.find("running") | int>=0) %}
                          {%- set dev.running = ent %}
                        {%- endif %}
                        {%- if (ent.find("newest_version") | int>=0) %}
                          {%- set dev.newest_version = ent %}
                        {%- endif %}
                        {%- if (ent.find("version") | int>=0) %}
                          {%- set dev.version = ent %}
                        {%- endif %}
                        {%- if (ent.find("cpu_percent") | int>=0) %}
                          {%- set dev.cpu_percent = ent %}
                        {%- endif %}
                        {%- if (ent.find("memory_percent") | int>=0) %}
                          {%- set dev.memory_percent = ent %}
                        {%- endif %}
                        {%- if (ent.find("update") | int>=0) %}
                          {%- set dev.update = ent %}
                        {%- endif %}
                      {%- endfor %}
                      {%- if dev.version > '' %}
                        {{-
                          { 'type': 'section'
                          }
                        }},
                        {{-
                          { 'type': 'custom:mushroom-title-card',
                            'title': dev.name
                          }
                        }},
                        {{-
                          { 'type': 'custom:mushroom-chips-card',
                            'chips': [
                              {
                                'type': 'entity',
                                'entity': dev.running,
                                'icon_color': 'green'
                              },
                              {
                                'type': 'entity',
                                'entity': dev.version,
                                'icon_color': 'green',
                                'icon': 'mdi:package-variant-closed-check'
                              },
                              {
                                'type': 'entity',
                                'entity': dev.newest_version,
                                'icon_color': 'purple',
                                'icon': 'mdi:package-variant'
                              },
                              {
                                'type': 'entity',
                                'entity': dev.cpu_percent,
                                'icon_color': 'blue'
                              },
                              {
                                'type': 'entity',
                                'entity': dev.memory_percent,
                                'icon_color': 'orange'
                              },
                            ]
                          }
                        }},
                        {{-
                          { 'type': 'custom:mushroom-update-card',
                            'entity': dev.update,
                            'name': dev.name,
                            'show_buttons_control': true,
                            'collapsible_controls': false,
                            'icon_type': 'entity-picture',
                            'layout': 'horizontal'
                          }
                        }},
                      {%- endif %}
                    {%- endfor %}
