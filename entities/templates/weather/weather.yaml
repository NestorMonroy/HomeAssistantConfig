---
sensor:
  - name: "[Weather] Current Condition"
    unique_id: weather_current_condition
    icon: mdi:weather-partly-snowy-rainy
    state: >
      {% if has_value('weather.tempest_daily') %}
        {% set condition = states('weather.tempest_daily') %}
      {% elif has_value('weather.tempest_daily') %}
        {% set condition = states('weather.tempest_daily') %}
      {% elif has_value('weather.east_tamworth') %}
        {% set condition = states('weather.east_tamworth') %}
      {% endif %}

      {% if condition|lower == 'clear' and is_state('sensor.day_night','Day') %} sunny
      {% elif condition|lower == 'clear' and is_state('sensor.day_night','Night') %} clear-night
      {% elif condition|lower in ['mainly clear','mainly sunny','clear-day'] %} sunny
      {% elif condition|lower == 'mist' %} fog
      {% elif condition|lower in ['haze','partly cloudy','partly-cloudy-day','partly-cloudy-night'] %} partlycloudy
      {% elif condition|lower == 'mostly cloudy' %} cloudy
      {% elif condition|lower in ['light rain','rain'] %} rainy
      {% elif condition|lower in ['light snow','snow'] %} snowy
      {% elif condition|lower == 'thunderstorm' %} lightning-rainy
      {% elif condition|lower == 'heavy rain' %} pouring
      {% elif condition|lower == 'precipitation' %} rainy
      {% elif condition|lower == 'wind' %} windy
      {% else %} {{ condition|lower }}
      {% endif %}
    attributes:
      provider: >
        {% if has_value('weather.tempest_daily') %} WeatherFlow Local
        {% elif has_value('weather.tempest_daily') %} WeatherFlow Cloud
        {% elif has_value('weather.east_tamworth') %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ has_value('weather.tempest_daily')
          or has_value('weather.tempest_daily')
          or has_value('weather.east_tamworth') }}

  - name: "[Weather] Temperature"
    unique_id: weather_temperature
    device_class: temperature
    state_class: measurement
    unit_of_measurement: °C
    state: >
      {% if is_number(states('sensor.weatherflow_air_temperature')) %}
        {{ states('sensor.weatherflow_air_temperature')|float }}
      {% elif is_number(states('sensor.tempest_st_00056115_temperature')) %}
        {{ states('sensor.tempest_st_00056115_temperature')|float }}
      {% elif is_number(states('sensor.tamworth_airport_temp')) %}
        {{ states('sensor.tamworth_airport_temp')|float }}
      {% else %} 0
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_air_temperature')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_temperature')) %} WeatherFlow Local
        {% elif is_number(states('sensor.tamworth_airport_temp')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_air_temperature'))
          or is_number(states('sensor.tempest_st_00056115_temperature'))
          or is_number(states('sensor.tamworth_airport_temp')) }}

  - name: "[Weather] Apparent Temperature"
    unique_id: weather_apparent_temperature
    device_class: temperature
    state_class: measurement
    unit_of_measurement: °C
    state: >
      {% if is_number(states('sensor.weatherflow_feels_like_temperature')) %}
        {{ states('sensor.weatherflow_feels_like_temperature')|float }}
      {% elif is_number(states('sensor.tempest_st_00056115_feels_like_temperature')) %}
        {{ states('sensor.tempest_st_00056115_feels_like_temperature')|float }}
      {% elif is_number(states('sensor.tamworth_airport_temp_feels_like')) %}
        {{ states('sensor.tamworth_airport_temp_feels_like')|float }}
      {% else %}
        {{ states('sensor.weather_temperature')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_feels_like_temperature')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_feels_like_temperature')) %} WeatherFlow Local
        {% elif is_number(states('sensor.tamworth_airport_temp_feels_like')) %} Bureau of Meteorology
        {% else %} Outdoor Temp
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_feels_like_temperature'))
          or is_number(states('sensor.tempest_st_00056115_feels_like_temperature'))
          or is_number(states('sensor.tamworth_airport_temp_feels_like'))
          or is_number(states('sensor.weather_temperature')) }}

  - name: "[Weather] High Temperature"
    unique_id: weather_high_temperature
    device_class: temperature
    state_class: measurement
    unit_of_measurement: °C
    state: >
      {% if state_attr('sensor.tempest_st_00056115_temperature','max_day') is defined
          and is_number(state_attr('sensor.tempest_st_00056115_temperature','max_day')) %}
        {{ state_attr('sensor.tempest_st_00056115_temperature','max_day')|float }}
      {% elif is_number(states('sensor.tamworth_airport_max_temp')) %}
        {{ states('sensor.tamworth_airport_max_temp')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if state_attr('sensor.tempest_st_00056115_temperature','max_day') is defined
            and is_number(state_attr('sensor.tempest_st_00056115_temperature','max_day')) %} Weatherflow Local
        {% elif is_number(states('sensor.tamworth_airport_max_temp')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ (state_attr('sensor.tempest_st_00056115_temperature','max_day') is defined
            and is_number(state_attr('sensor.tempest_st_00056115_temperature','max_day')))
          or is_number(states('sensor.tamworth_airport_max_temp')) }}

  - name: "[Weather] Low Temperature"
    unique_id: weather_low_temperature
    device_class: temperature
    state_class: measurement
    unit_of_measurement: °C
    state: >
      {% if state_attr('sensor.tempest_st_00056115_temperature','min_day') is defined
          and is_number(state_attr('sensor.tempest_st_00056115_temperature','min_day')) %}
        {{ state_attr('sensor.tempest_st_00056115_temperature','min_day')|float }}
      {% elif is_number(states('sensor.tamworth_airport_min_temp')) %}
        {{ states('sensor.tamworth_airport_min_temp')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if state_attr('sensor.tempest_st_00056115_temperature','min_day') is defined
            and is_number(state_attr('sensor.tempest_st_00056115_temperature','min_day')) %} Weatherflow Local
        {% elif is_number(states('sensor.tamworth_airport_min_temp')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ (state_attr('sensor.tempest_st_00056115_temperature','min_day') is defined
            and is_number(state_attr('sensor.tempest_st_00056115_temperature','min_day')))
          or is_number(states('sensor.tamworth_airport_min_temp')) }}

  - name: "[Weather] Dew Point"
    unique_id: weather_dew_point
    device_class: temperature
    state_class: measurement
    unit_of_measurement: °C
    state: >
      {% if is_number(states('sensor.weatherflow_dewpoint')) %}
        {{ states('sensor.weatherflow_dewpoint')|float }}
      {% elif is_number(states('sensor.tempest_st_00056115_dew_point')) %}
        {{ states('sensor.tempest_st_00056115_dew_point')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_dewpoint')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_dew_point')) %} WeatherFlow Local
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_dewpoint'))
          or is_number(states('sensor.tempest_st_00056115_dew_point')) }}

  - name: "[Weather] Humidity"
    unique_id: weather_humidity
    device_class: humidity
    state_class: measurement
    unit_of_measurement: "%"
    state: >
      {% if is_number(states('sensor.weatherflow_relative_humidity')) %}
        {{ states('sensor.weatherflow_relative_humidity')|int }}
      {% elif is_number(states('sensor.tempest_st_00056115_humidity')) %}
        {{ states('sensor.tempest_st_00056115_humidity')|int }}
      {% elif is_number(states('sensor.tamworth_airport_humidity')) %}
        {{ states('sensor.tamworth_airport_humidity')|int }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_relative_humidity')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_humidity')) %} WeatherFlow Local
        {% elif is_number(states('sensor.tamworth_airport_humidity')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_relative_humidity'))
          or is_number(states('sensor.tempest_st_00056115_humidity'))
          or is_number(states('sensor.tamworth_airport_humidity')) }}

  - name: "[Weather] Precipitation Probability"
    unique_id: weather_precipitation_probability
    icon: mdi:weather-rainy
    state_class: measurement
    unit_of_measurement: "%"
    state: >
      {% if state_attr('weather.tempest_hourly','forecast')[0] is defined
          and is_number(state_attr('weather.tempest_hourly','forecast')[0].precipitation_probability) %}
        {{ state_attr('weather.tempest_hourly','forecast')[0].precipitation_probability|int }}
      {% elif is_number(states('sensor.weatherflow_precipitation_probability')) %}
        {{ states('sensor.weatherflow_precipitation_probability')|int }}
      {% elif is_number(states('sensor.tempest_st_00056115_precipitation_probability')) %}
        {{ states('sensor.tempest_st_00056115_precipitation_probability')|int }}
      {% elif is_number(states('sensor.east_tamworth_rain_chance_0')) %}
        {{ states('sensor.east_tamworth_rain_chance_0')|int }}
      {% endif %}
    attributes:
      provider: >
        {% if state_attr('weather.tempest_hourly','forecast')[0] is defined
          and is_number(state_attr('weather.tempest_hourly','forecast')[0].precipitation_probability) %} Hourly Forecast
        {% elif is_number(states('sensor.weatherflow_precipitation_probability')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_precipitation_probability')) %} WeatherFlow Local
        {% elif is_number(states('sensor.east_tamworth_rain_chance_0')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ state_attr('weather.tempest_hourly','forecast')[0] is defined
            and is_number(state_attr('weather.tempest_hourly','forecast')[0].precipitation_probability)
          or is_number(states('sensor.weatherflow_precipitation_probability'))
          or is_number(states('sensor.tempest_st_00056115_precipitation_probability'))
          or is_number(states('sensor.east_tamworth_rain_chance_0')) }}

  - name: "[Weather] Precipitation Probability Today"
    unique_id: weather_precipitation_probability_today
    icon: mdi:weather-rainy
    state_class: measurement
    unit_of_measurement: "%"
    state: >
      {% if state_attr('weather.tempest_daily','forecast')[0] is defined
          and is_number(state_attr('weather.tempest_daily','forecast')[0].precipitation_probability) %}
        {{ state_attr('weather.tempest_daily','forecast')[0].precipitation_probability|int }}
      {% endif %}
    attributes:
      provider: Daily Forecast
    availability: >
      {{ state_attr('weather.tempest_daily','forecast')[0] is defined
          and is_number(state_attr('weather.tempest_daily','forecast')[0].precipitation_probability) }}

  - name: "[Weather] Precipitation Intensity"
    unique_id: weather_precipitation_intensity
    icon: mdi:weather-pouring
    state: >
      {% if states('sensor.tempest_st_00056115_rain_intensity')|lower != 'none' %}
        {{ states('sensor.tempest_st_00056115_rain_intensity') }}
      {% elif states('sensor.weatherflow_precipitation_intensity')|lower != 'none' %}
        {{ states('sensor.weatherflow_precipitation_intensity') }}
      {% else %} 0
      {% endif %}
    attributes:
      provider: >
        {% if states('sensor.tempest_st_00056115_rain_intensity') != 'None' %} WeatherFlow Local
        {% elif states('sensor.weatherflow_precipitation_intensity') != 'none' %} WeatherFlow Cloud
        {% else %} WeatherFlow Local
        {% endif %}
    availability: >
      {{ has_value('sensor.tempest_st_00056115_rain_intensity')
          or has_value('sensor.weatherflow_precipitation_intensity') }}

  - name: "[Weather] Precipitation Rate"
    unique_id: weather_precipitation_rate
    icon: mdi:weather-pouring
    device_class: precipitation_intensity
    state_class: measurement
    unit_of_measurement: mm/h
    state: >
      {% if has_value('sensor.tempest_st_00056115_rain_rate') %}
        {{ states('sensor.tempest_st_00056115_rain_rate')|float }}
      {% elif has_value('sensor.weatherflow_precipitation_rate') %}
        {{ states('sensor.weatherflow_precipitation_rate')|float }}
      {% else %} none
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tempest_st_00056115_rain_rate')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_precipitation_rate')) %} WeatherFlow Cloud
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_rain_rate'))
          or is_number(states('sensor.weatherflow_precipitation_rate')) }}

  - name: "[Weather] Precipitation Duration Today"
    unique_id: weather_precipitation_duration_today
    icon: mdi:timer
    device_class: duration
    state_class: measurement
    unit_of_measurement: min
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_rain_duration_today')) %}
        {{ states('sensor.tempest_st_00056115_rain_duration_today')|float }}
      {% elif is_number(states('sensor.weatherflow_precipitation_duration_today')) %}
        {{ states('sensor.weatherflow_precipitation_duration_today')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_precipitation_duration_today')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_precipitation_duration_today')) %} WeatherFlow Cloud
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_rain_duration_today'))
          or is_number(states('sensor.weatherflow_precipitation_duration_today')) }}

  - name: "[Weather] Precipitation Duration Yesterday"
    unique_id: weather_precipitation_duration_yesterday
    icon: mdi:timer
    device_class: duration
    state_class: measurement
    unit_of_measurement: min
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_rain_duration_yesterday')) %}
        {{ states('sensor.tempest_st_00056115_rain_duration_yesterday')|float }}
      {% elif is_number(states('sensor.weatherflow_precipitation_duration_yesterday')) %}
        {{ states('sensor.weatherflow_precipitation_duration_yesterday')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tempest_st_00056115_rain_duration_yesterday')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_precipitation_duration_yesterday')) %} WeatherFlow Cloud
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_rain_duration_yesterday'))
          or is_number(states('sensor.weatherflow_precipitation_duration_yesterday')) }}

  - name: "[Weather] Precipitation Today"
    unique_id: weather_precipitation_today
    icon: mdi:weather-pouring
    device_class: distance
    state_class: measurement
    unit_of_measurement: mm
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_rain_today')) %}
        {{ states('sensor.tempest_st_00056115_rain_today')|float }}
      {% elif is_number(states('sensor.weatherflow_precipitation_today')) %}
        {{ states('sensor.weatherflow_precipitation_today')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_precipitation_today')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_rain_today')) %} WeatherFlow Local
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_precipitation_today'))
          or is_number(states('sensor.tempest_st_00056115_rain_today')) }}

  - name: "[Weather] Precipitation Yesterday"
    unique_id: weather_precipitation_yesterday
    icon: mdi:weather-pouring
    device_class: distance
    state_class: measurement
    unit_of_measurement: mm
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_rain_yesterday')) %}
        {{ states('sensor.tempest_st_00056115_rain_yesterday')|float }}
      {% elif is_number(states('sensor.weatherflow_precipitation_yesterday')) %}
        {{ states('sensor.weatherflow_precipitation_yesterday')|float }}
      {% elif is_number(states('sensor.east_tamworth_precipitation_yesterday')) %}
        {{ states('sensor.east_tamworth_precipitation_yesterday')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tempest_st_00056115_rain_yesterday')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_precipitation_yesterday')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.east_tamworth_precipitation_yesterday')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_rain_yesterday'))
          or is_number(states('sensor.weatherflow_precipitation_yesterday'))
          or is_number(states('sensor.east_tamworth_precipitation_yesterday')) }}

  - name: "[Weather] Precipitation Type"
    unique_id: weather_precipitation_type
    icon: mdi:weather-rainy
    device_class: enum
    state: >
      {% set freeze_alt = states('sensor.tempest_st_00056115_freezing_level_altitude')|int(-1) %}
      {% if has_value('sensor.tempest_st_00056115_precipitation_type') %}
        {% set type = states('sensor.tempest_st_00056115_precipitation_type')|lower %}
        {% if type != 'none' %} {{ type }}
        {% elif freeze_alt != -1 and freeze_alt < 200 %} snow
        {% else %} rain
        {% endif %}
      {% else %}
        {% if is_state('binary_sensor.weatherflow_is_freezing','on') %} snow
        {% else %} rain
        {% endif %}
      {% endif %}
    attributes:
      provider: >
        {% if has_value('sensor.tempest_st_00056115_precipitation_type') %} WeatherFlow Local
        {% else %} WeatherFlow Cloud
        {% endif %}
    availability: >
      {{ has_value('sensor.tempest_st_00056115_precipitation_type')
          or states('binary_sensor.weatherflow_is_freezing') in ['off','on'] }}

  - name: "[Weather] Lightning Count"
    unique_id: weather_lightning_count
    icon: mdi:lightning-bolt
    state_class: measurement
    unit_of_measurement: strikes
    state: >
      {% if is_number(states('sensor.weatherflow_lightning_strike_count')) %}
        {{ states('sensor.weatherflow_lightning_strike_count')|int }}
      {% elif is_number(states('sensor.tempest_st_00056115_lightning_count')) %}
        {{ states('sensor.tempest_st_00056115_lightning_count')|int }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_lightning_strike_count')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_lightning_count')) %} WeatherFlow Local
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_lightning_strike_count'))
          or is_number(states('sensor.tempest_st_00056115_lightning_count')) }}

  - name: "[Weather] Barometric Pressure"
    unique_id: weather_barometric_pressure
    device_class: pressure
    state_class: measurement
    unit_of_measurement: hPa
    state: >
      {% if is_number(states('sensor.weatherflow_barometric_pressure')) %}
        {{ states('sensor.weatherflow_barometric_pressure')|float }}
      {% elif is_number(states('sensor.tempest_st_00056115_sea_level_pressure')) %}
        {{ states('sensor.tempest_st_00056115_sea_level_pressure')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.weatherflow_barometric_pressure')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_sea_level_pressure')) %} WeatherFlow Local
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_barometric_pressure'))
          or is_number(states('sensor.tempest_st_00056115_sea_level_pressure')) }}

  - name: "[Weather] Wind Speed"
    unique_id: weather_wind_speed
    icon: mdi:weather-windy
    device_class: wind_speed
    state_class: measurement
    unit_of_measurement: km/h
    state: >
      {% if is_number(states('sensor.tamworth_airport_wind_speed_kilometre')) %}
        {{ states('sensor.tamworth_airport_wind_speed_kilometre')|float }}
      {% elif is_number(states('sensor.weatherflow_wind_speed_km_h')) %}
        {{ states('sensor.weatherflow_wind_speed_km_h')|float }}
      {% elif is_number(states('sensor.tempest_st_00056115_wind_speed')) %}
        {{ states('sensor.tempest_st_00056115_wind_speed')|float * 3.6 }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tamworth_airport_wind_speed_kilometre')) %} Bureau of Meteorology
        {% elif is_number(states('sensor.weatherflow_wind_speed_km_h')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tempest_st_00056115_wind_speed')) %} WeatherFlow Local
        {% endif %}
    availability: >
      {{ is_number(states('sensor.weatherflow_wind_speed_km_h'))
          or is_number(states('sensor.tempest_st_00056115_wind_speed'))
          or is_number(states('sensor.tamworth_airport_wind_speed_kilometre')) }}

  - name: "[Weather] Wind Gust"
    unique_id: weather_wind_gust
    icon: mdi:weather-windy
    device_class: wind_speed
    state_class: measurement
    unit_of_measurement: km/h
    state: >
      {% if is_number(states('sensor.tamworth_airport_gust_speed_kilometre')) %}
        {{ states('sensor.tamworth_airport_gust_speed_kilometre')|float }}
      {% elif is_number(states('sensor.tempest_st_00056115_wind_gust')) %}
        {{ states('sensor.tempest_st_00056115_wind_gust')|float * 3.6 }}
      {% elif is_number(states('sensor.weatherflow_wind_gust_km_h')) %}
        {{ states('sensor.weatherflow_wind_gust_km_h')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tamworth_airport_gust_speed_kilometre')) %} Bureau of Meteorology
        {% elif is_number(states('sensor.tempest_st_00056115_wind_gust')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_wind_gust_km_h')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tamworth_airport_gust_speed_kilometre')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_wind_gust'))
          or is_number(states('sensor.weatherflow_wind_gust_km_h'))
          or is_number(states('sensor.tamworth_airport_gust_speed_kilometre')) }}

  - name: "[Weather] Wind Lull"
    unique_id: weather_wind_lull
    icon: mdi:weather-windy
    device_class: wind_speed
    state_class: measurement
    unit_of_measurement: km/h
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_wind_lull')) %}
        {{ states('sensor.tempest_st_00056115_wind_lull')|float * 3.6 }}
      {% elif is_number(states('sensor.weatherflow_wind_lull_km_h')) %}
        {{ states('sensor.weatherflow_wind_lull_km_h')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tempest_st_00056115_wind_lull')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_wind_lull_km_h')) %} WeatherFlow Cloud
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_wind_lull'))
          or is_number(states('sensor.weatherflow_wind_lull_km_h')) }}

  - name: "[Weather] Wind Bearing"
    unique_id: weather_wind_bearing
    state_class: measurement
    unit_of_measurement: °
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_wind_bearing')) %}
        {{ states('sensor.tempest_st_00056115_wind_bearing')|float }}
      {% elif is_number(states('sensor.weatherflow_wind_direction')) %}
        {{ states('sensor.weatherflow_wind_direction')|float }}
      {% elif is_number(states('sensor.tamworth_airport_wind_direction')) %}
        {{ states('sensor.tamworth_airport_wind_direction') }}
      {% endif %}
    attributes:
      cardinal: >
        {% set directions = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW','N'] %}
        {{ directions[((states('sensor.weather_wind_bearing')|float(-1)/360)|float*16)|round] }}
      full_cardinal: >
        {% set directions = ['North','North-Northeast','Northeast','East-Northeast','East','East-Southeast',
            'Southeast','South-Southeast','South','South-Southwest','Southwest','West-Southwest','West',
            'West-Northwest','Northwest','North-Northwest','North'] %}
        {{ directions[((states('sensor.weather_wind_bearing')|float(-1)/360)|float*16)|round] }}
      provider: >
        {% if is_number(states('sensor.tempest_st_00056115_wind_bearing')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_wind_direction')) %} WeatherFlow Cloud
        {% elif is_number(states('sensor.tamworth_airport_wind_direction')) %} Bureau of Meteorology
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_wind_bearing'))
          or is_number(states('sensor.weatherflow_wind_direction'))
          or is_number(states('sensor.tamworth_airport_wind_direction')) }}

  - name: "[Weather] Wind Beaufort Display"
    unique_id: weather_wind_beaufort_display
    icon: mdi:windsock
    state: "{{ states('sensor.weatherflow_beaufort_description')|replace('_',' ')|title }}"
    attributes:
      provider: WeatherFlow Cloud
    availability: "{{ has_value('sensor.weatherflow_beaufort_description') }}"

  - name: "[Weather] Visibility"
    unique_id: weather_visibility
    icon: mdi:eye
    device_class: distance
    state_class: measurement
    unit_of_measurement: km
    state: >
      {% if is_number(states('sensor.tempest_st_00056115_visibility')) %}
        {{ states('sensor.tempest_st_00056115_visibility')|float }}
      {% elif is_number(states('sensor.weatherflow_visibility')) %}
        {{ states('sensor.weatherflow_visibility')|float }}
      {% endif %}
    attributes:
      provider: >
        {% if is_number(states('sensor.tempest_st_00056115_visibility')) %} WeatherFlow Local
        {% elif is_number(states('sensor.weatherflow_visibility')) %} WeatherFlow Cloud
        {% endif %}
    availability: >
      {{ is_number(states('sensor.tempest_st_00056115_visibility'))
          or is_number(states('sensor.weatherflow_visibility')) }}

  - name: "[Weather] Nearest Storm Bearing"
    unique_id: weather_nearest_storm_bearing
    state: "{{ states('sensor.pirateweather_nearest_storm_bearing')|float(none) }}"
    state_class: measurement
    unit_of_measurement: "°"
    attributes:
      provider: Pirate Weather
    availability: "{{ is_number(states('sensor.pirateweather_nearest_storm_bearing')) }}"

  - name: "[Weather] Nearest Storm Distance"
    unique_id: weather_nearest_storm_distance
    device_class: distance
    state_class: measurement
    unit_of_measurement: km
    state: "{{ states('sensor.pirateweather_nearest_storm_distance')|int(none) }}"
    attributes:
      provider: Pirate Weather
    availability: "{{ is_number(states('sensor.pirateweather_nearest_storm_distance')) }}"

  - name: "[Weather] Cloud Cover"
    unique_id: weather_cloud_cover
    icon: mdi:cloud
    state_class: measurement
    unit_of_measurement: "%"
    state: "{{ states('sensor.pirateweather_cloud_coverage')|int(none) }}"
    attributes:
      provider: Pirate Weather
    availability: "{{ is_number(states('sensor.pirateweather_cloud_coverage')) }}"

  - name: "[Weather] Rain Soon (12Hr Lookahead)"
    unique_id: weather_rain_soon
    icon: mdi:weather-pouring
    state: >
      {% set found = namespace(value=0) %}
      {% if is_state('sensor.weather_precipitation_type','rain') %}
        {% set threshold = 25 %}
        {% set forecast = state_attr('weather.tempest_hourly','forecast') %}
        {% for item in forecast %}
          {% if loop.index0 < 12 and item.precipitation_probability|int(-1) >= threshold %}
            {% set found.value = 1 %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {{ found.value == 1 }}
    availability: >
      {{ state_attr('weather.tempest_hourly','forecast') != none
          and state_attr('weather.tempest_hourly','forecast')[0] is defined }}
